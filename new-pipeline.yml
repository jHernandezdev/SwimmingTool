parameters:
  - name: pathToFiles
    type: string
  - name: artifactName
    type: string

trigger: none

stages:
- stage: build
  jobs:
  - job: run_build
    pool:
      vmImage: 'ubuntu-latest'
    steps:   
    # - task: CopyFiles@2
    #   displayName: 'Copy scripts'
    #   inputs:
    #     contents: '${{ parameters.pathToFiles }}/**'
    #     targetFolder: '$(Build.ArtifactStagingDirectory)'

    - publish: '$(Build.SourcesDirectory)/${{ parameters.pathToFiles }}'
      displayName: 'Publish script'
      artifact: ${{ parameters.artifactName }}

- stage: test
  dependsOn: build
  jobs:
  - job: run_test
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - download: current
      artifact: ${{ parameters.artifactName }}
      
    - powershell: |
        $directoryInfo = Get-ChildItem '$(Pipeline.Workspace)/${{ parameters.pathToFiles }}'
        $directoryInfo.count
        
        if ( $directoryInfo.count -gt 0 ) 
        {          
          $directoryInfo[0]
        }
      displayName: 'PowerShell Script'
